<!DOCTYPE html>
<html>
<head>
<title>Page Title</title>
</head>
<style type="text/css">
	canvas { border: 1px solid #ccc }
</style>
<canvas id="c" width="1000" height="500"></canvas>
<!-- <input x-webkit-speech> -->
<button onclick="thick()">Thick Line</button>
<button onclick="thin()">Thin Line</button>
<button onclick="erase()">Erase</button>
<button onclick="aidraw()">AI draw</button>
<button onclick="checkdata()">Clear Canvas</button>

<button onclick="saveme()">Save Drawing</button>
<button onclick="loadme()">Load Drawing</button>
<!-- <button onclick="list()">List of my Drawings</button>
 -->

<!-- <textarea id="results" cols="80" rows="5"></textarea>
<button onclick="startDictation()">Start</button> -->
<!-- <input type="text" id="speech" style="font-size: 40px;"  name="speech" size="50" /> -->
<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>


<script>

//    var el = document.getElementById('c');
// var ctx = el.getContext('2d');
   // ctx.lineWidth = 5;
// ctx.lineJoin = ctx.lineCap = 'round';


//firebase
  var config = {
    apiKey: "AIzaSyBA1zN9fWE8BY1nisk65Te77KGwfwZeDR0",
    authDomain: "mobsidian-262f9.firebaseapp.com",
    databaseURL: "https://mobsidian-262f9.firebaseio.com",
    projectId: "mobsidian-262f9",
    storageBucket: "mobsidian-262f9.appspot.com",
    messagingSenderId: "812445897675"
  };
  firebase.initializeApp(config);

  var database = firebase.database();


var iamerasing=0;
var tellonce=0;
var cancellightbrush=0; 

//save

//ref.push(data)

///


///retrieve
// ref.on('value',gotData, errData);

// function gotData(data) {
// console.log(data.val())
// var coordinates =data.val();

// var keys = Object.keys(coordinates)
// console.log(coordinates)
// for(var i=0; i<keys.length;i++) {
// console.log('inside')
//   var p=keys[i];

// var shuju=coordinates[p].coords;
// var shujunames=coordinates[p].name;
//   console.log(p)
//     console.log(shuju,shujunames)
// }


// }


// function errData(err) {
//    console.log(err)
// }

///////

function list () {
  var ref = database.ref('mobsidian-262f9')
 var check = ref.orderByKey();
console.log(check);
var keys = Object.keys(check)
var valus=coordinates =check.val();
console.log(valus)
ref.on('value',gotData, errData);

// var ref = firebase.database().ref("mobsidian-262f9");
// var usersQuery = ref.val();
// console.log(usersQuery)

}
///
var thickthin=0;
array = ['1', '2', '3', 'xx1', '4', '5', 'xx2', '6', '7', '8', 'xx3'];

for(var i =0; i<array.length; i++) {
  var st= array[i];
  var num= 'xx'+i;
if (st=='xx1') {
   var it= array.indexOf(st);
  it++
 array = array.slice(it, array.length);
}

}


// var it= array.indexOf('xx');
//it++
  //array.splice(it, 1);
//it=it-1;

//array = array.slice(it, array.length); //Need to assign it to the same or another variable

console.log(array);

var startgo=0; 




var secretArrayX=[];
var secretArrayY=[];
var orginacoordinateX=[];
var orginacoordinateY=[];
var agentX=[];  //clone of originacoordX
var counter=0;
 var negate=0; 
 var erasecounter=0;
   var el = document.getElementById('c');
var ctx = el.getContext('2d');

ctx.save();
function thick () {
iamerasing=0;
thickthin=1;

}

function thin () {
iamerasing=0;
thickthin=0;
ctx.restore();
ctx.save();
console.log('lob',thickthin)
}
var isDrawing, points = [ ];

el.onmousedown = function(e) {
  isDrawing = true;
     if (iamerasing==0) {
        points.push({ x: e.clientX, y: e.clientY });
     }

    if (iamerasing==1) {
    //ctx.clearRect (e.clientX, e.clientY, e.clientX, e.clientY);
  }
  //console.log('baby',points)
};

el.onmousemove = function(e) {
  if (!isDrawing) return;
cancellightbrush=1;
    if (thickthin==0) {
    console.log('zob',thickthin)
  

//       ctx.lineWidth = 0;
// ctx.lineJoin = ctx.lineCap = 'round';
  }

    if (thickthin==1) {
    console.log('mob',thickthin)
    ctx.lineWidth = 5;
ctx.lineJoin = ctx.lineCap = 'round';
  }

   if (iamerasing==1) {

    ctx.clearRect(0.5, 1, e.clientX, e.clientY);

}
if (iamerasing==0) {
  //ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
  points.push({ x: e.clientX, y: e.clientY });
// console.log('baby',e.clientX, e.clientY)
secretArrayX.push(e.clientX);
     secretArrayY.push(e.clientY);
  ctx.beginPath();
  ctx.moveTo(points[0].x, points[0].y);


  //console.log(points[0].x, e.clientX)
  for (var i = 1; i < points.length; i++) {
    ctx.lineTo(points[i].x, points[i].y);
  }
  ctx.globalAlpha=1;
ctx.strokeStyle = "rgba(0, 0, 0, 1)";
  ctx.stroke();

}
};

el.onmouseup = function() {
  isDrawing = false;
  
if (iamerasing==0) {
  console.log('switz', points)
  orginacoordinateX.push(points[0].x)
  agentX=orginacoordinateX;
  orginacoordinateY.push(points[0].y)
  //orginacoordinateX.push('XX');
  //orginacoordinateY.push('YY')
counter+=1;
var xsample = 'XX'+counter
var ysample = 'YY'+counter
console.log('exlusive', xsample, ysample)
  secretArrayX.push(xsample);
  secretArrayY.push(ysample)
  console.log('wo de', orginacoordinateX,orginacoordinateY)
  console.log('baby',secretArrayX,secretArrayY)

  points.length = 0;
}
  //iamerasing=0;
};


var dataURL;
function aidraw() {
// if (startgo==1) {
var image=new Image();
image.onload=function(){
    ctx.drawImage(image,0,0);
}
image.src=dataURL;


    //setTimeout(saveme,2000)
//    console.log(secretArrayX.length);
// console.log(secretArrayY.length);
//var idleInterval = setInterval(timetoDraw, 2000); 
//timetoDraw();
 
}

function erase () {
  iamerasing=1;
  thickthin=0;

if (tellonce==0) {
  alert('Hold down mouse and hover over where you want to erase. Click thin line or thick line when you are done');
  tellonce=1;
  }
}

function checkdata() {
  console.log('i will draw this')
   console.log(secretArrayX);
console.log(secretArrayY);
  var el2 = document.getElementById('c');
 dataURL=el2.toDataURL();
  ctx.clearRect(0, 0, el.width, el.height);

// timetoDraw();
}


var didi=0; 
var it2=0;
function timetoDraw () {//
     var el2 = document.getElementById('c');
var ctx2 = el2.getContext('2d');
var times = 0;

  //ctx.lineWidth = 10;
  //ctx.lineJoin = ctx.lineCap = 'round';
  console.log(secretArrayX.length);
  console.log(secretArrayY.length);
  //for(var m=0; m<orginacoordinateY.length; m++) {/////

// var f1=orginacoordinateY[m];

    function remove(array, element) {
    return array.filter(e => e !== element);
}

var xx;
var yy;
var xpos;
 var ypos;
pupos();

function pupos () {
console.log('cake')
console.log('wtf???', secretArrayY.length)
   // for(var q=0; q<agentX.length; q++) {

        xx =orginacoordinateX[0];
        yy=orginacoordinateY[0];
didi++;
console.log('creator',didi)


console.log('pupos',times,xx, yy)

// var it= orginacoordinateX.indexOf(xx);
//   orginacoordinateX.splice(it, 1);

//   var it2= orginacoordinateY.indexOf(yy);
//     orginacoordinateY.splice(it, 1);



    var randominput;
     var randominput2;
     randominput = orginacoordinateX[0];
var vowels = remove(orginacoordinateX, randominput);
orginacoordinateX=vowels;


randominput2 = orginacoordinateY[0];
var vowels2 = remove(orginacoordinateY, randominput2);
orginacoordinateY=vowels2;
     



console.log('ordinary',orginacoordinateX, orginacoordinateY)
       ctx2.beginPath();
         ctx2.moveTo(xx, yy);
          racken();
   // }


// if (didi==0) {

  
//   times++
//   console.log('racken', times)
// }
}


function racken () {//

    console.log('harmony', times)
  for(var i=0; i<secretArrayX.length; i++) {//

    xpos = secretArrayX[i];
   ypos = secretArrayY[i];
var cloney='';
var clonex='';
var xsample='XX'+didi;
var ysample='YY'+didi;
// console.log('nothin',xsample);
// console.log('nothin',ysample);
           

  if (xpos==xsample) {//
            clonex=xpos;
  var it= secretArrayX.indexOf(xpos);
  //var pro=it;
  it++
   secretArrayX = secretArrayX.slice(it, secretArrayX.length);  //0, it = good
// console.log('after',secretArrayX)
 xpos=secretArrayX[it];
   // var string=secretArrayX[it];
   //  it2= secretArrayX.indexOf(string);
  //console.log('before',pro,it,it2,string,'lazy',secretArrayX)

 // startgo=0;
 //  console.log('finished', startgo)

  
}//
if (ypos==ysample) {//
        cloney=ypos;
  var it= secretArrayY.indexOf(ypos);
  it++
  secretArrayY = secretArrayY.slice(it, secretArrayY.length); 
 ypos=secretArrayY[it];
 // console.log(secretArrayY)
}//


      if (cloney==ysample && clonex==xsample && secretArrayY.length>1 && times==0) {//
  pupos();
  //console.log('shun yi',secretArrayX)

}//
   
     //console.log('yeah',xpos,ypos)


    // ctx.moveTo(23, 35);

//if (xpos>=1 && ypos>=1) {//

   // ctx.restore()
//console.log('i drew')

       if (secretArrayY.length==0) {
  times=1;
  //console.log('break here')
  break;
  
}



//}//

//firebase save xcoord and y coord
     // ctx2.lineWidth = 1;
//ctx2.lineJoin = ctx2.lineCap = 'round';
if (cancellightbrush==0) {
ctx2.globalAlpha=0.1;
ctx2.strokeStyle = "rgba(0, 0, 0, 0.1)";
}
    ctx2.lineTo(xpos, ypos);
 

    ctx2.stroke();


  }



 
}//



}//

 var msg;
function saveme () {

    msg = window.prompt("Please give your drawing a name", "Name");
  //alert(msg);

  console.log(msg)
setTimeout(supersave,2000)

}



function supersave () {
    var ref=database.ref(msg);

var data = {

   name:"data",
  coordsx:secretArrayX,
  coordsy:secretArrayY
}
ref.push(data)
}


function loadme () {
  if (cancellightbrush==1) {
    cancellightbrush=0;
  }

     msg = window.prompt("Please write the name of the past drawing", "Name");
 

  console.log(msg)
setTimeout(load,2000)




function load() {///

  var ref = database.ref(msg)
ref.on('value',gotData, errData);

function gotData(data) {
console.log(data.val())
var coordinates =data.val();

var keys = Object.keys(coordinates)
console.log(coordinates)
for(var i=0; i<keys.length;i++) {
console.log('inside')
  var p=keys[i];

var shuju=coordinates[p].coordsx;
var shujunames=coordinates[p].coordsy;
secretArrayX=shuju;
secretArrayY=shujunames;
  console.log(p)
    console.log(shuju,shujunames)
    timetoDraw();
}


}


function errData(err) {
   console.log(err)
}


}///








}


</script>
<body>

<!-- <h1>Welcome to Mobsid's Animation Platform</h1> -->
<p></p>




</body>
</html>
